# 實驗設計：利用貝葉斯優化尋找最佳 Filter Bank 截止頻率

## 1. 研究問題與假設

-   **研究問題**:
    是否存在一組比 `leadership_code` 預設參數 (`[0.5, 1, 2, 3, 4, 5, 7, 9, 15, 30] Hz`) 更優的 Filter Bank 截止頻率組合，能夠在特定事件（如 `HandStart`）的預測上取得更高的平均 AUC 分數？

-   **核心假設**:
    `leadership_code` 的參數雖然有效，但可能不是針對此數據集的全局最優解。透過系統性的超參數搜索，我們可以找到一組新的參數組合，以進一步提升模型的預測性能。

## 2. 方法論：單階段貝葉斯優化

### 2.1 核心挑戰

Filter Bank 的截止頻率是一組連續的超參數，其組合空間巨大，無法透過手動調參或暴力網格搜索 (Grid Search) 進行有效探索。

### 2.2 解決方案：貝葉斯優化 (Bayesian Optimization)

我們將採用**貝葉斯優化**來自動化地、高效地搜索最佳的頻率組合。

-   **工作原理**: 透過 `代理模型` 和 `採集函數` 的協作，貝葉斯優化能夠在「探索」和「利用」之間取得平衡，用比隨機搜索少得多的嘗試次數，快速收斂到一個接近全局最優的解。
-   **使用工具**: `scikit-optimize` (`skopt`) 函式庫。

## 3. 實驗 Pipeline 設計

整個實驗將由一個專屬的啟動腳本 `run_optimization.sh` 呼叫一個新的後端引擎 `search_hyperparameters.py` 來執行。

### 3.1 搜索空間 (Search Space)

為了確保產生的頻率組合 `f1 < f2 < ... < f10`，我們將定義 10 個連續且不重疊的搜索區間。

-   `freq_1`: `[0.1, 1.0]` Hz
-   `freq_2`: `[1.0, 3.0]` Hz
-   `freq_3`: `[3.0, 5.0]` Hz
-   `freq_4`: `[5.0, 7.0]` Hz
-   `freq_5`: `[7.0, 10.0]` Hz
-   `freq_6`: `[10.0, 14.0]` Hz
-   `freq_7`: `[14.0, 20.0]` Hz
-   `freq_8`: `[20.0, 28.0]` Hz
-   `freq_9`: `[28.0, 38.0]` Hz
-   `freq_10`: `[38.0, 45.0]` Hz

### 3.2 目標函數 (Objective Function)

這是貝葉斯優化器在每次迭代中執行的核心任務。

1.  **輸入**: 一組由優化器推薦的包含 10 個截止頻率的列表。
2.  **執行**:
    -   **數據範圍**: 根據 `run_optimization.sh` 傳入的參數，選定要進行優化的**受試者 (Subjects)** 和**通道 (Channels)**。
    -   **數據劃分**: 對於每個選定的受試者，嚴格使用 `series 1-6` 作為訓練集，`series 7-8` 作為驗證集。
    -   **循環**: 在所有選定的 `subject` 和 `channel` 組合上進行循環。
        -   **特徵工程**: 使用當前迭代的頻率參數，建立 `FilterBank` 物件並轉換數據。
        -   **模型訓練**: 訓練一個 `Logistic Regression` 模型。
        -   **模型評估**: 在驗證集上計算 AUC 分數。
3.  **輸出**:
    -   返回所有評估結果的**平均 AUC 分數**的**負值**（因為 `skopt` 的目標是最小化）。

### 3.3 執行流程

1.  使用者在 `mycode/experiment/optimize_filterbank_freqs/` 目錄下執行 `./run_optimization.sh <subjects> <channels> <event>`。
2.  `run_optimization.sh` 呼叫 `mycode/scripts/search_hyperparameters.py` 引擎，並傳入參數。
3.  `search_hyperparameters.py` 啟動 `gp_minimize` 貝葉斯優化器，設定迭代次數（可由命令列傳入，預設為 25 次）。
4.  優化器開始執行「目標函數」的循環，反覆進行 `推薦 -> 訓練 -> 評估 -> 反饋` 的過程。
5.  所有迭代完成後，腳本將打印出最佳的頻率組合和對應的最高平均 AUC 分數。

## 4. 預期產出

-   **`optimization_results.txt`**: 一個位於實驗目錄下的文字檔案，清晰地記錄了找到的最佳頻率組合和其對應的最終 AUC 分數。
-   **`run_exp.log`**: 一個位於實驗目錄下的日誌檔案，詳細記錄了每一次迭代測試的頻率、得到的 AUC 分數以及完整的程式輸出，方便追蹤和分析優化過程。
